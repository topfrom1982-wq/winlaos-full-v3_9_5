<!DOCTYPE html>
<html lang="lo">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Winlaos168 | ‡∫ó‡∫≤‡∫á‡ªÄ‡∫Ç‡∫ª‡ªâ‡∫≤‡∫´‡∫º‡∫¥‡ªâ‡∫ô</title>

<!-- ‚úÖ Facebook Pixel (Browser) -->
<script>
!function(f,b,e,v,n,t,s)
{if(f.fbq)return;n=f.fbq=function(){n.callMethod?
n.callMethod.apply(n,arguments):n.queue.push(arguments)};
if(!f._fbq)n.queue=[];t=b.createElement(e);t.async=!0;
t.src=v;s=b.getElementsByTagName(e)[0];
s.parentNode.insertBefore(t,s)}(window, document,'script',
'https://connect.facebook.net/en_US/fbevents.js');
fbq('init', '1119119273700263');
fbq('track', 'PageView');
</script>
<noscript>
  <img height="1" width="1" style="display:none"
  src="https://www.facebook.com/tr?id=1119119273700263&ev=PageView&noscript=1"/>
</noscript>

<style>
body {margin:0;font-family:'Noto Sans Lao','Kanit',sans-serif;background:#000;color:#fff;text-align:center;}
.container{max-width:420px;margin:auto;padding:20px;}
.logo{width:160px;margin-top:60px;}
button{width:100%;border:none;border-radius:14px;padding:16px;font-size:1.1rem;font-weight:600;cursor:pointer;margin-top:20px;}
#enterBtn{background:linear-gradient(90deg,#FFD700,#E6B800);color:#000;}
#contactBtn{background:linear-gradient(90deg,#1877F2,#0e5dc7);color:#fff;}
footer{margin:40px 0 20px;font-size:0.8rem;color:#777;}
.popup-overlay{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.85);justify-content:center;align-items:center;}
.popup{background:#111;border:1px solid #FFD70050;border-radius:14px;padding:20px;width:80%;max-width:340px;}
.popup input{width:85%;padding:10px;border-radius:8px;border:1px solid #FFD70080;background:#000;color:#fff;margin-bottom:15px;text-align:center;}
#debugBox{background:#111;border:1px solid #333;border-radius:10px;margin:20px auto;padding:10px;width:90%;max-width:400px;text-align:left;font-size:0.8rem;color:#0f0;white-space:pre-wrap;}
</style>
</head>
<body>
<div class="container">
  <img src="images/logo.webp" alt="Winlaos168" class="logo">
  <h1>‡∫ç‡∫¥‡∫ô‡∫î‡∫µ‡∫ï‡ªâ‡∫≠‡∫ô‡∫Æ‡∫±‡∫ö‡∫™‡∫π‡ªà <span style="color:#FFD700">Winlaos168</span> üé∞</h1>
  <button id="enterBtn">üé∞ ‡∫ó‡∫≤‡∫á‡ªÄ‡∫Ç‡∫ª‡ªâ‡∫≤‡∫´‡∫º‡∫¥‡ªâ‡∫ô</button>
  <button id="contactBtn">üí¨ ‡∫ï‡∫¥‡∫î‡∫ï‡ªç‡ªà‡ªÅ‡∫≠‡∫î‡∫°‡∫¥‡∫ô</button>
  <footer>¬© 2025 Winlaos168. All rights reserved.</footer>
</div>

<!-- ‚úÖ Popup -->
<div class="popup-overlay" id="popupOverlay">
  <div class="popup">
    <h2 style="color:#FFD700;">‡ªÉ‡∫™‡ªà‡ªÄ‡∫ö‡∫µ‡ªÇ‡∫ó‡∫Ç‡∫≠‡∫á‡∫ó‡ªà‡∫≤‡∫ô</h2>
    <input 
      type="tel" 
      id="winlaos_phone" 
      value="020" 
      maxlength="11" 
      pattern="[0-9]*" 
      inputmode="numeric"
      oninput="if(!this.value.startsWith('020')) this.value='020'+this.value.replace(/[^0-9]/g,'').replace(/^0+/,''); if(this.value.length>11) this.value=this.value.slice(0,11);" 
      readonly 
      onfocus="this.removeAttribute('readonly'); setTimeout(()=>this.setSelectionRange(this.value.length,this.value.length),0);"
    >
    <button id="winlaos_confirm">‡∫¢‡∫∑‡∫ô‡∫¢‡∫±‡∫ô</button>
    <button id="winlaos_close" style="background:#333;color:#fff;margin-top:8px;">‡∫õ‡∫¥‡∫î</button>
  </div>
</div>

<!-- ‚úÖ Debug Log Box -->
<div id="debugBox">[DEBUG LOG]</div>

<script>
(() => {
  const PIXEL_ID = "1119119273700263";
  const ACCESS_TOKEN = "EAAP0Y2nQyVgBP9zJGF6xqhgeZA4Y9ZCmyqBBbvc6i4i1jprm7UjcBD15vq5zZAoNZCam9ZCAq3BZBhABZBVNt67tXCSgkI4GYNWZAKqSVrDQxr86lqhqa9ZBNhHzQFii2ZArsjNfGsnUk7FcVrduzkDrDyffdphADxwUTNfaS57uo4Fno8ZCWnpqOVPnynDsTXoaZCOscAZDZD";
  const REDIRECT_URL = "https://mvpatm.pro";
  const debugBox = document.getElementById("debugBox");

  const popup = document.getElementById("popupOverlay");
  const enterBtn = document.getElementById("enterBtn");
  const confirmBtn = document.getElementById("winlaos_confirm");
  const closeBtn = document.getElementById("winlaos_close");
  const phoneInput = document.getElementById("winlaos_phone");
  const savedPhone = localStorage.getItem("winlaos_phone");

  function log(msg){console.log(msg);debugBox.textContent += "\n" + msg;}

  async function sha256(message) {
    const msgBuffer = new TextEncoder().encode(message);
    const hashBuffer = await crypto.subtle.digest("SHA-256", msgBuffer);
    return Array.from(new Uint8Array(hashBuffer)).map(b => b.toString(16).padStart(2, "0")).join("");
  }

  async function sendMetaEvent(phone) {
    const eventTime = Math.floor(Date.now() / 1000);
    const userData = {
      ph: await sha256(phone.trim()),
      client_user_agent: navigator.userAgent
    };
    const payload = {
      data: [{
        event_name: "Purchase",
        event_time: eventTime,
        action_source: "website",
        event_source_url: window.location.href,
        user_data: userData,
        custom_data: { currency: "USD", value: 1.00 }
      }]
    };

    try {
      const res = await fetch(`https://graph.facebook.com/v20.0/${PIXEL_ID}/events?access_token=${ACCESS_TOKEN}`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(payload)
      });
      const data = await res.json();
      log("‚úÖ Conversions API Response:\n" + JSON.stringify(data, null, 2));

      fbq('track', 'Purchase', { currency: "USD", value: 1.00 });
      if (data.events_received === 1) log("üéØ Facebook ‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢!");
      else log("‚ö†Ô∏è Meta ‡πÑ‡∏°‡πà‡∏ï‡∏≠‡∏ö events_received = 1");
    } catch (err) {
      log("‚ùå Error ‡∏™‡πà‡∏á event: " + err.message);
    }
  }

  enterBtn.onclick = async () => {
    if (savedPhone) {
      log("‚û°Ô∏è ‡πÉ‡∏ä‡πâ‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÄ‡∏î‡∏¥‡∏°‡∏à‡∏≤‡∏Å localStorage: " + savedPhone);
      await sendMetaEvent(savedPhone);
      setTimeout(() => (window.location.href = REDIRECT_URL), 800);
    } else popup.style.display = "flex";
  };

  confirmBtn.onclick = async () => {
    let phone = phoneInput.value.trim();
    if (!phone.startsWith("020")) phone = "020" + phone.replace(/^0+/, "");
    if (!phone.match(/^020[0-9]{6,8}$/)) return alert("‚ö†Ô∏è ‡ªÉ‡∫™‡ªà‡ªÄ‡∫ö‡∫µ‡ªÉ‡∫´‡ªâ‡∫ñ‡∫∑‡∫Å‡∫ï‡ªâ‡∫≠‡∫á!");
    localStorage.setItem("winlaos_phone", phone);
    log("‚òéÔ∏è ‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÉ‡∏´‡∏°‡πà: " + phone);
    await sendMetaEvent(phone);
    popup.style.display = "none";
    alert("‚úÖ ‡∫™‡∫≥‡ªÄ‡∫•‡∫±‡∫î! ‡∫Å‡∫≥‡∫•‡∫±‡∫á‡ªÄ‡∫Ç‡∫ª‡ªâ‡∫≤...");
    setTimeout(() => (window.location.href = REDIRECT_URL), 800);
  };

  closeBtn.onclick = () => (popup.style.display = "none");
})();
</script>
</body>
</html>
